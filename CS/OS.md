## 운영체제

### 운영체제와 컴퓨터

#### 운영체제의 역할

1. CPU 스케줄링과 프로세스 관리 : CPU 소유권을 어떤프로세스에 할당할지, 프로세스의 생성과 삭제, 자원 할당 및 반환을 관리
2. 메모리 관리 : 한정된 메모리를 어떤 프로세스에 얼마큼 할당해야 하는지 관리
3. 디스크 파일 관리 : 디스크 파일을 어떠한 방법으로 보관할지 관리
4. I/O 디바이스 관리 : I/O 디바이스들인 마우스, 키보드와 컴퓨터 간에 데이터를 주고 받는 것을 관리



#### 운영체제의 구조

유저 프로그램 - GUI - 시스템콤 - 커널 - 드라이버 - 하드웨어

##### 시스템콜

> 커널에 접근하기 위한 인터페이스, 유저 프로그램이 운영체제의 서비스를 받기 위해 커널 함수를 호출할 때 사용

I/O 요청으로 trap 발동 확인 후 시스템콜을 통해 커널 모드로 변환 실행

##### modebit

> 시스템콜이 작동될 때 modebit을 참고해서 유저 모드와 커널 모드를 구분

0(커널 모드)과 1(유저 모드)을 갖는 플래그 변수

커널 모드 : 유저의 접근을 제한하며 컴퓨터 자원에 침범하지 못하는 모드(보안적)

유저 모드  : 모든 컴퓨터 자원에 접근할 수 있는 모드



### 컴퓨터의 요소

#### CPU(Central Processing Unit)

산술논리연산장치, 제어장치, 레지스터로 구성

##### 제어장치(Control Unit)

프로세스 조작을 지시하는 CPU의 한 부품

입출력장치 간 통신을 제어하고 명령어들을 읽고 해석, 데이터 처리를 위한 순서를 결정

##### 레지스터

매우 빠른 임시기억장치

메모리 보다 연산 속도가 수십 배에서 수백 배까지 빠름 / 저장하지 못하고 바로 데이터 전달

##### 산술논리연산장치(ALU, Arithmetic Logic Unit)

두 숫자의 연산을 하는 디지털 회로



#### CPU의 연산 처리

1. 제어장치가 메모리에 계산할 값을 로드 / 또한 레지스터에도 로드
2. 제어장치가 레지스터에 있는 값을 계산하라고 산술논리연산장치에 명령
3. 계산된 값을 다시 레지스터에서 메모리로 계산한 값을 저장

##### 인터럽트

CPU를 잠깐 정지시키는 것 / 오류를 반환

- 하드웨어 인터럽트 - 키보드나 마우스 연결등 IO 디바이스에서 발생
- 소프트웨어 인터럽트 - trap이라고 함 / 프로세스 오류

##### DMA 컨트롤러

I/O 디바이스가 메모리에 직접 접근할 수 있도록 하는 하드웨어 장치

CPU부하 막아줌

##### 메모리

데이터, 상태, 명령어 등을 기록 보관하는 장치

##### 타이머

시간이 많이 걸리는 프로그램이 동작할 때 제한을 걸기 위해 존재

##### 디바이스 컨트롤러

IO 디바이스들의 작은 CPU



### 메모리

#### 메모리 계층

<속도 빠름>	레지스터 - 캐시 - 메모리 - 저장장치	<용량 큼>

- 레지스터 : CPU 내부 작은 메모리, 휘발성, 속도 빠름, 용량 작음
- 캐시 : L1, L2 캐시, 휘발성, 속도 빠름, 용량 작음
- 주기억장치 : RAM, 휘발성, 속도 보통, 용량 보통
- 보조기억장치 : HDD,SDD  휘발성, 속도 낮음, 용량 큼



#### 캐시(cache)

데이터를 미리 복사해 놓는 임시 저장소, 빠른 장치와 느린 장치 사이의 병목 현상을 줄이기 위한 메모리

##### 지역성의 원리

시간 지역성(temporal locality)와 공간 지역성(spatial locality)

##### 시간 지역성

최근 사용한 데이터에 다시 접근 하려는 특성

##### 공간 지역성

최근 접근한 데이터를 이루고 있는 공간이나 가까운 공간에 접근하는 특성



#### 캐시히트와 캐시미스

캐시에서 원하는 데이터를 찾았다면 캐시히트 - CPU에서 동작

해당 데이터가 없으면 주 메모리로 가서 데이터를 찾아오는 것을 캐시미스 - 메모리 에서 동작

##### 캐시매핑

캐시가 히트되기 위해 매핑하는 방법

직접매핑 - 처리가 빠르지만 충돌이 잦음

연관 매핑 - 처리가 느리지만 충돌이 적음

집합 연관 매핑 - 순서는 일치시키지만 집합을 둬서 좀 더 효율적인 탐색



#### 웹 브라우저의 캐시

##### 쿠키

만료 기한이 있는 키값 저장소

same site = strict 하지 않으면 다른 도메인이 요청하면 자동 전송 4KB

documnet.cookie로 쿠키를 볼 수 없게 httponly 옵션 중요

보통 서버에서 만료 기한 정함

##### 로컬 스토리지

만료 기한이 없는 키값 저장소

10MB까지 저장 / 웹 페이지를 닫아도 유지

##### 세션 스토리지

만료 없는 키갑 저장소

탭 단위로 생성, 탭을 닫을 때 해당 데이터가 삭제



#### 메모리 관리

##### 가상 메모리

메모리 자원을 추상화 하여 이를 사용하는 사용자들에게 매우 큰 메모리로 보이게 만드는 것

##### 스와핑

가상 메모리에는 존재하지만 실제 메모리인 RAM에는 없는 데이터나 코드에 접근하면 페이지 폴트 발생

사용하지 않는 필요없는 부분을 내리고 필요한 부분을 올리는 과정

##### 페이지 폴트

1. 방생하면 트랩을 발생
2. CPU잠깐 멈춤
3. 페이지 테이블을 확인하여 존재하는지 확인하고, 없다면 프로세스를 중단하고 물리 메모리에 비어 있는 프레임을 찾음, 없으면 스와핑 발동
4. 비어 있는 프레임에 해당 페이지를 로드, 페이지 테이블을 최신화
5. CPU다시 시작

##### 스레싱

메모리 페이지 폴트율이 높음(성능 저하 발생) 아래의 방법들로 해결

##### 작업 세트

결정된 페이지 집합을 만들어서 미리 메모리에 로드

##### PFF

페이지 폴트 빈도를 조절하는 방법

##### 메모리 할당

고정 분할 방식 - 메모리를 미리 나누어 관리하는 방식 / 융통성 없음 / 내부 단편화 발행

가변 분할 방식 - 프로그램의 크기에 맞게 동적으로 메모리를 나눠 사용

##### 내부 단편화

메모리를 나눈 크기보다 프로그램이 작아서 들어가지 못하는 공간이 많이 발생하는 현상

##### 외부 단편화

메모리를 나눈 크기보다 프로그램이 커서 들어가지 못하는 공간이 많이 발생하는 현상

##### 페이징

동일한 크기의 페이지 단위로 나누어 메모리의 서로 다른 위치에 프로세스 할당

##### 세그멘테이션

페이지 단위가 아닌 세그먼트로 나누는 방식

보안에 좋음

##### 페이지 교체 알고리즘

##### LRU (Least Recentle Used)

참조가 오래된 것을 바꿈

해시 테이블과 이중 연결 리스트를 사용

##### NUR (Not Used Recently)

사용되지 않은 0을 1로 바꾸는 알고리즘

##### LFU (Least Frequently Used)

사용 횟수가 적은 것 교체



### 프로세스와 스레드

프로세스 - 컴퓨터에서 실행되고 있는 프로그램

스레드 - 프로세스 내 작업의 흐름

#### 컴파일 과정

![image](https://velog.velcdn.com/images/narangke3/post/a9daf66d-aab5-41a7-b8c0-268b535ea7a2/image.png)

##### 전처리

소스코드의 주석을 제거하고 #include 등 헤더 파일을 병합하여 매크로를 치환

##### 컴파일러

오류 처리, 코드 최적화 작업을 하며 어셈블리어로 변화

##### 어셈블러

목적 코드로 변환

##### 링커

실행 파일을 만듦



#### 프로세스의 상태

생성 상태

대기 상태

대기 중단 상태

실행 상태

중단 상태

일시 중단 상태

종료 상태



#### 프로세스의 메모리 구조

##### 스택

동적할당

##### 힙

동적할당

##### 데이터 영역

정적인 특징

BSS는 0으로 초기화 저장

Data 영역은 0이 아닌 다른 값으로 할당

##### 코드 영역

소스 코드

수정 불가능한 기계어로 저장



#### PCB (Process Control Block)

운영체제에서 프로세스에 대한 메타데이터를 저장한 데이터

프로세스가 생성되면 스택,힙 등의 구조를 기반으로 메모리 할당

이 프로세스의 메타데이터들이 PCB에 저장되어 관리

중요하기 때문에 커널 스택의 가장 앞부분에서 관리

##### PCB구조

- 프로세스 스케줄링 상태 : 프로세스가 CPU에 대한 소유권을 얻은 이후의 상태
- 프로세스 ID : 프로세스 ID, 해당 프로세스 자식 프로세스 ID
- 프로세스 권한 : 컴퓨터 자원 또는 I/O 디바이스에 대한 권한 정보
- 프로그램 카운터 : 프로세스에서 실행하야 할 다음 명령어의 주소에 대한 포인터
- CPU 레지스터 : 프로세스를 실행하기 위해 저장해야 할 레지스터에 대한 정보
- CPU 스케줄링 정보 : CPU 스케줄러에 의해 중단된 시간 등에 대한 정보
- 계정 정보 : 프로세스 실행에 사용된 CPU 사용량, 실행한 유저의 정보
- I/O 상태 정보 : 프로세스에 할당된 I/O 디바이스 목록

##### 컨텍스트 스위칭

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile22.uf.tistory.com%2Fimage%2F994590345BB1B4DB2F7E5C)

스위칭이 일어날 때 유휴 시간이 발생 / 캐시미스라는 비용이 발생



#### 멀티 프로세싱

두가지 이상의 일을 수행 (병렬처리로)

##### IPC(Inter Process Communication)

프로세스 끼리 데이터를 주고 받고 공유 데이터를 관리하는 메커니즘

##### 공유 메모리

여러 프로세스에 동일한 메모리 블록에 대한 접근 권한이 부여되어 프로세스가 서로 통신할 수 있도록 공유 버퍼를 생성

##### 파일

디스크에 저장된 데이터 또는 파일 서버에서 제공한 데이터

##### 소켓

네트워크 인터페이스를 통해 전송하는 데이터 TCP UDP

##### 익명 파이프

임시 공간인 파이프로 데이터를 주고받음

##### 명명된 파이프

단/이중 파이프

파이프 서버와 파이프 클라이언트 간의 통신

##### 메시지 큐

다른 IPC에 비해 사용 방법이 매우 직관적

다른 코드의 수정 없이 단지 몇 줄의 코드를 추가시켜 간단하게 메시지 큐에 접근 가능



#### 스레드와 멀티스레딩

##### 스레드

프로세스의 실행 가능한 가장 작은 단위

##### 멀티 스레딩

스레드 끼리 서로 자원을 공유하기 때문에 효율이 높음



#### 공유 자원과 임계 영역

##### 공유 자원

굥유자원을 두 개 이상의 프로세스가 동시에 읽거나 쓰는 현상을 경쟁 상태

##### 임계 영역

점근 순서등의 이유로 처리에 문제가 생겨 결과가 달라지는 영역을 임계 영역이라고 함

뮤텍스, 세마포어, 모니터 세가지 방법으로 처리

상호 배제, 한정 대기, 융통성

##### 뮤텍스

사용하기 전에 설저하고 사용한 이후 해제하는 잠금

##### 세마포어

wait() 만큼 기다리고 signal()로 다른 프로세스 진행

- 바이너리 세마포어 : 뮤텍스와 비슷하지만 신호를 기반으로 상호 배제가 일어나는 신호 메커니즘
- 카운팅 세마포어 : 여러 개의 값을 가질 수 있는 세마포어

##### 모니터

둘 이상의 스레드나 프로세스가 공유 자원에 안전하게 접근할 수 있도록 공유 자원을 숨기고 해당 접근에 대해 인터페이스만 제공



#### 교착 상태

두가 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태

원인 : 상호 배제 / 점유 대기 / 비선점 / 환형 대기

해결

1. 자원을 할당할 때 애초에 조건이 성립되지 않도록 설계
2. 교착 상태 가능성이 없을 때만 자원 할당되며, 프로세스당 요청할 자원들의 최대치를 통해 자원 할당 가능 여부를 파악하는 알고리즘. (은행원알고리즘)
3. 교착 상태가 발생하면 사이클이 있는지 찾아보고 이에 관련된 프로세스를 한 개씩 지움
4. 처리 비용이 더 커서 사용자가 종료



### CPU 스케줄링 알고리즘

#### 비선점형 방식

##### FCFS

먼저 온것 먼저 처리 / 준비 큐에서 오래 기다리는 현상

##### SJF

실행 시간이 가장 짧은 프로세스를 가장 먼저 실행

##### 우선순위

우선순위를 높이는 방법을 통해 단점을 보완

#### 선점형 방식

##### 라운드로빈 (RR)

동일한 할당 시간을 주고 그 시간 안에 끝나지 않으면 다시 대기 큐로 돌아감

로드 밸런서에서 트래픽 분산 알고리즘

##### SRF

중간에 더 짧은 작업이 들어오면 다 관두고 그거를 먼저 수행

##### 다단계 큐

큐를 여러개 준비하여 다 다른 방식으로 처리하는 방법
