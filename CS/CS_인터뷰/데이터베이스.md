## 데이터베이스

### 데이터베이스의 기본

데이터들은 특정 DBMS마다 정의된 쿼리 언어를 통해 삽입, 삭제, 수정, 조회 등이 가능

실시간 접근과 동시 공유가 가능



#### 엔터티(entity)

여러 개의 속성을 지닌 명사

##### 약한 엔티티와 강한 엔티티

예를 들어 A는 B에 종속적이고, 혼자 존재하지 못한다면, A는 약한 엔티티, B는 강한 엔티티이다.



#### 릴레이션(relation)

데이터베이스에서 정보를 구분하여 저장하는 기본 단위

관계형 데이터베이스에서는 '테이블' / NoSQL 데이터베이스에서는 '컬렉션'



#### 속성(attribute)

릴레이션에서 관리하는 구체적이며 고유한 이름을 갖는 정보



#### 도메인(domain)

릴레이션에 포함된 각각의 속성들이 가질 수 있는 값의 집합



#### 필드와 레코드

데이터베이스에서 필드와 레코드로 구성된 테이블을 만들 수 있음

행 단위의 데이터를 레코드 / 레코드를 튜플 이라고도 함

##### 필드 타입

- 숫자 타입
- 날짜 타입
  - DATE
  - DATETIME
  - TIMESTAMP
- 문자 타입
  - CHAR VARCHAR
  - TEXT BLOB
  - ENUM SET



#### 관계

테이블은 서로의 관계가 정의

- 1:1관계
- 1:N 관계
- N:M 관계



#### 키

테이블 간의 관계를 조금 더 명확하게 하고 테이블 자체의 인덱스를 위해 설정된 장치로 기본키, 외래키, 후보키, 슈퍼키, 대체키가 있음

- 기본키(PK)
  - 유일성과 최소성
  - 고유의 키
- 외래키(FK)
  - 다른 테이블의 기본키를 그대로 참조하는 값
- 후보키
  - 기본키가 될 수 있는 후보들
  - 유일성과 최소성 동시에 만족
- 대체키
  - 후보키가 두 개 이상일 경우 하나를 기본키로 지정하고 남은 후보키들
- 슈퍼키
  - 각 레코드를 유일하게 식별할 수 있는 유일성을 갖춘 키



### ERD와 정규화 과정

Entity Relationship Diagram  은 데이터베이스를 구축할 때 가장 기초적인 뼈대 역할



#### 정규화 과정

데이터베이스 이상 현상 해결 및 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정

##### 정규형 원칙

같은 의미를 표현하는 릴레이션이지만 좀 더 좋은 구조로 만들어야 하고, 자료의 중복성은 감소해야 하고, 독립적인 관계는 별개의 릴레이션으로 표현해야 하며, 각각의 릴레이션은 독립적인 표현이 가능해야함



##### 제1 정규형

모든 도메인이 더 이상 분해될 수 없는 원자 값으로만 구성

##### 제2 정규형

릴레이셔닝 제 1정규형이며 부분 함수의 종속성을 제거한 형태

기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것

##### 제3 정규형

제 2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속을 만족하지 않는 상태

##### 보이스/코드 정규형

BCNF는 제3정규형이고, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태



### 트랜잭션과 무결성

#### 트랜잭션

원자성, 일관성, 독립성, 지속성 (ACID)

##### 원자성

트랙잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장하는 특징

커밋은 여러 쿼리가 성공적으로 처리되었다고 화정하는 명령어

롤백은 트랙잭션 전으로 돌리는 것

##### 일관성

허용된 방식으로만 데이터를 변경해야 하는 것

##### 독립성

트랙잭션 수행 시 서로 끼어들지 못하는것

##### 	격리 수준에 따라 발생하는 현상

- 팬텀 리드 : 한 트랜잭션 내에서 동일한 쿼리를 보냈을 때 해당 조회 결과가 다른 경우
- 반복 가능하지 않은 조회 : 한트랙잭션 내의 같은 행에 두 번 이상 조회가 발생했는데, 그 값이 다른 경우
- 더티 리드 : 한 트랜잭션이 실행 중일 때 다른 트랜잭션에 의해 수정되었지만 아직 커밋되지 않은 행의 데이터를 읽을 수 있을 때 발생

	##### 	격리 수준

- SERIALIZABLE : 순차적으로 진행,  엄격한 수준의 격리
- REPEATABLE_READ : 수정한 행을 다른 트랜잭션이 수정할 수 없도록 막지만, 새로운 행 추가는 막지 않음
  - 팬텀 리드
- READ_COMMITTED : 가장 많이 사용되는 격리 수준 / 커밋 완료된 데이터에 대해서만 조회 가능
  - 팬텀 리드, 반복 가능하지 않은 조회
- READ_UNCOMMITTED : 가장 낮은 수준의 격리 / 가장 빠름 / 어림 잡아 집계하는 데 사용하면 좋음
  - 팬텀 리드, 반복 가능하지 않은 조회, 더티 리드

##### 지속성

성공적으로 수행된 트랜잭션은 영원히 반영되어함



#### 무결성

데이터의 정확성, 일관성, 유효성을 유지하는 것



### 데이터베이스의 종류

#### 관계형 데이터베이스

##### MySQL

가장 많이 사용

##### PostgreSQL

그 다음 선호하는 데이터베이스 기술

디스크 조각이 차지하는 영역을 회수할 수 있는 장치인 VACUUM이 특징

#### NoSQL 데이터베이스

MongoDB와 redis

##### MongoDB

JSON을 통해 데이터에 접근

뛰어난 확장성

##### ridis

기본적인 데이터 타입은 str



### 인덱스

#### B-트리

루트 노드 , 리프 노드, 브랜치 노드로 나뉨

대수확장성이란 트리 깊이가 리프 노드 수에 비해 매우 느리게 성장하는 것

인덱스가 한 깊이씩 증가할 때마다 최대 인덱스 항목의 수는 4배씩 증가



#### 인덱스 최적화 기법

1. 인덱스는 비용이다
2. 항상 테스팅 하라
3. 복합 인덱스는 같음, 정렬, 다중 값, 카디널리티 순서이다



### 조인의 종류

조인이란 두 개 이상의 테이블을 묶어서 하나의 결과물을 만드는 것

#### 내부 조인

왼쪽 테이블과 오른쪽 테이블의 두 행이 모두 일치하는 행이 있는 부분만 표기

#### 왼쪽 조인

왼쪽 테이블의 모든 행이 결과 테이블에 표기

#### 오른쪽 조인

오른쪽 테이블의 모든 행이 결과 테이블에 표기

#### 합집합 조인

두 개의 테이블을 기반으로 조인 조건에 만족하지 않는 행 까지 모두 표기



### 조인의 원리

#### 중첩 루프 조인

중첩 for문과 같은 원리로 조건에 맞는 조인을 하는 방법

비용이 많이 증가하여 대용량에서는 사용하지 않음

#### 정렬 병합 조인

각각의 테이블을 조인할 필드 기준으로 정렬하고 정렬이 끝난 이후에 조인 작업을 수행하는 조인

#### 해시 조인

해시 테이블을 기반으로 조인하는 방법

##### 빌드 단계

입력 테이블 중 하나를 기반으로 메모리 내 해시 테이블을 빌드하는 단계

##### 프로브 단계

레코드 읽기를 시작
